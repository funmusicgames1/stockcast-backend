<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>StockCast — Daily Stock Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #F7F6F2; --surface: #FFFFFF; --border: #E4E2DA;
      --text: #12110F; --muted: #8A887E;
      --gain: #1A7A4A; --gain-bg: #EAF5EE;
      --loss: #B8363A; --loss-bg: #FCEAEA;
      --accent-alt: #C8F135; --tag-bg: #F0EFE9;
    }
    html { scroll-behavior: smooth; }
    body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; line-height: 1.6; min-height: 100vh; }

    nav { position: sticky; top: 0; z-index: 100; background: rgba(247,246,242,0.92); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 0 2rem; display: flex; align-items: center; justify-content: space-between; height: 60px; }
    .nav-logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.15rem; letter-spacing: -0.02em; display: flex; align-items: center; gap: 8px; }
    .logo-dot { width: 8px; height: 8px; background: var(--accent-alt); border-radius: 50%; display: inline-block; }
    .nav-right { display: flex; align-items: center; gap: 1.5rem; }
    .nav-time { font-family: 'DM Mono', monospace; font-size: 0.75rem; color: var(--muted); letter-spacing: 0.04em; }
    .nav-badge { background: var(--gain-bg); color: var(--gain); font-family: 'DM Mono', monospace; font-size: 0.7rem; font-weight: 500; padding: 3px 10px; border-radius: 20px; border: 1px solid #C3E6D0; letter-spacing: 0.03em; }

    .hero { padding: 4rem 2rem 2.5rem; max-width: 1200px; margin: 0 auto; animation: fadeUp 0.6s ease both; }
    .hero-label { font-family: 'DM Mono', monospace; font-size: 0.7rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); margin-bottom: 1rem; }
    .hero h1 { font-family: 'Syne', sans-serif; font-weight: 800; font-size: clamp(2.2rem, 5vw, 3.8rem); line-height: 1.05; letter-spacing: -0.03em; max-width: 700px; }
    .hero h1 span { color: var(--muted); }
    .hero-sub { margin-top: 1rem; color: var(--muted); font-size: 0.95rem; max-width: 600px; }
    .disclaimer { margin-top: 1.5rem; display: inline-flex; align-items: center; gap: 6px; background: #FFF8E6; border: 1px solid #F0DFA0; border-radius: 6px; padding: 6px 12px; font-size: 0.75rem; color: #8A7030; }

    .section { max-width: 1200px; margin: 0 auto; padding: 0 2rem 3rem; }
    .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.2rem; }
    .section-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1.05rem; letter-spacing: -0.01em; display: flex; align-items: center; gap: 8px; }
    .section-title .dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
    .dot-gain { background: var(--gain); } .dot-loss { background: var(--loss); } .dot-neutral { background: var(--muted); } .dot-accent { background: #C8A835; }
    .section-date { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); }

    .overview-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--border); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; animation: fadeUp 0.6s 0.1s ease both; }
    .overview-card { background: var(--surface); padding: 1.4rem 1.5rem; }
    .overview-card-label { font-size: 0.72rem; color: var(--muted); letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 0.5rem; font-family: 'DM Mono', monospace; }
    .overview-card-value { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1.6rem; letter-spacing: -0.02em; }
    .overview-card-change { font-family: 'DM Mono', monospace; font-size: 0.78rem; margin-top: 3px; }
    .up { color: var(--gain); } .down { color: var(--loss); } .neutral { color: var(--muted); }

    .stocks-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; animation: fadeUp 0.6s 0.2s ease both; }
    @media (max-width: 768px) { .stocks-layout { grid-template-columns: 1fr; } }
    .stock-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .panel-header { padding: 1.1rem 1.4rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .panel-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.92rem; display: flex; align-items: center; gap: 7px; }
    .pill { font-family: 'DM Mono', monospace; font-size: 0.65rem; font-weight: 400; padding: 2px 8px; border-radius: 20px; }
    .pill-gain { background: var(--gain-bg); color: var(--gain); }
    .pill-loss { background: var(--loss-bg); color: var(--loss); }
    .stock-row { display: grid; grid-template-columns: 28px 1fr auto; align-items: center; gap: 0.8rem; padding: 0.85rem 1.4rem; border-bottom: 1px solid var(--border); transition: background 0.15s; }
    .stock-row:last-child { border-bottom: none; }
    .stock-row:hover { background: var(--bg); }
    .stock-rank { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); text-align: center; }
    .stock-ticker { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.9rem; }
    .stock-name { font-size: 0.75rem; color: var(--muted); margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .stock-right { text-align: right; }
    .stock-pred { font-family: 'DM Mono', monospace; font-size: 0.88rem; font-weight: 500; }
    .stock-reason { font-size: 0.7rem; color: var(--muted); margin-top: 2px; }

    .perf-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; animation: fadeUp 0.6s 0.3s ease both; }
    .perf-table { width: 100%; border-collapse: collapse; }
    .perf-table thead tr { border-bottom: 1px solid var(--border); }
    .perf-table th { padding: 0.75rem 1.4rem; text-align: left; font-family: 'DM Mono', monospace; font-size: 0.68rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); font-weight: 400; }
    .perf-table th:last-child, .perf-table td:last-child { text-align: right; }
    .perf-table td { padding: 0.85rem 1.4rem; font-size: 0.85rem; border-bottom: 1px solid var(--border); }
    .perf-table tr:last-child td { border-bottom: none; }
    .perf-table tbody tr:hover { background: var(--bg); }
    .ticker-badge { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.85rem; }
    .accuracy-bar { display: inline-flex; align-items: center; gap: 6px; }
    .bar-track { width: 60px; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
    .bar-fill-gain { background: var(--gain); height: 100%; border-radius: 2px; }
    .bar-fill-loss { background: var(--loss); height: 100%; border-radius: 2px; }
    .tag { display: inline-block; background: var(--tag-bg); color: var(--muted); font-size: 0.65rem; font-family: 'DM Mono', monospace; padding: 2px 7px; border-radius: 4px; }
    .type-winner { background: var(--gain-bg); color: var(--gain); }
    .type-loser { background: var(--loss-bg); color: var(--loss); }
    .group-header td { padding: 0.5rem 1.4rem; font-family: 'DM Mono', monospace; font-size: 0.68rem; letter-spacing: 0.08em; text-transform: uppercase; }
    .group-winner { background: var(--gain-bg); } .group-winner td { color: var(--gain); }
    .group-loser { background: var(--loss-bg); } .group-loser td { color: var(--loss); }
    .pending-note { padding: 2.5rem 1.4rem; text-align: center; color: var(--muted); font-size: 0.85rem; font-family: 'DM Mono', monospace; line-height: 1.8; }

    .next-update { max-width: 1200px; margin: 0 auto; padding: 0 2rem 4rem; animation: fadeUp 0.6s 0.4s ease both; }
    .update-strip { border: 1px solid var(--border); border-radius: 12px; padding: 1.2rem 1.5rem; display: flex; align-items: center; justify-content: space-between; background: var(--surface); }
    .update-left { display: flex; align-items: center; gap: 12px; }
    .pulse-dot { width: 10px; height: 10px; background: var(--gain); border-radius: 50%; position: relative; }
    .pulse-dot::after { content: ''; position: absolute; inset: -4px; background: var(--gain); border-radius: 50%; opacity: 0.25; animation: pulse 1.8s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{transform:scale(1);opacity:0.25} 50%{transform:scale(1.8);opacity:0} }
    .update-label { font-size: 0.85rem; font-weight: 500; }
    .update-sub { font-size: 0.75rem; color: var(--muted); margin-top: 2px; font-family: 'DM Mono', monospace; }
    .countdown { font-family: 'DM Mono', monospace; font-size: 1.1rem; font-weight: 500; letter-spacing: 0.05em; }

    footer { border-top: 1px solid var(--border); padding: 1.5rem 2rem; max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .footer-logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.9rem; display: flex; align-items: center; gap: 6px; }
    .footer-note { font-size: 0.72rem; color: var(--muted); max-width: 500px; text-align: right; line-height: 1.5; }
    .loading-msg { max-width: 1200px; margin: 4rem auto; padding: 0 2rem; text-align: center; color: var(--muted); font-family: 'DM Mono', monospace; font-size: 0.85rem; line-height: 2; }

    @keyframes fadeUp { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body>

<nav>
  <div class="nav-logo"><span class="logo-dot"></span>StockCast</div>
  <div class="nav-right">
    <span class="nav-time" id="liveTime"></span>
    <span class="nav-badge">● LIVE</span>
  </div>
</nav>

<div class="hero">
  <div class="hero-label">Daily Stock Intelligence · Updated Every Day at 6 AM CST</div>
  <h1>Today's Market<br><span>Predictions.</span></h1>
  <p class="hero-sub" id="heroSummary">AI-powered analysis of top movers based on historical patterns, earnings, geopolitical signals, and macro conditions.</p>
  <div class="disclaimer">⚠ For informational purposes only. Not financial advice. Past predictions do not guarantee future results.</div>
</div>

<div id="app"><div class="loading-msg">Loading market data...</div></div>

<div class="next-update">
  <div class="update-strip">
    <div class="update-left">
      <div class="pulse-dot"></div>
      <div>
        <div class="update-label">Next update scheduled</div>
        <div class="update-sub">6:00 AM CST</div>
      </div>
    </div>
    <div class="countdown" id="countdown">—</div>
  </div>
</div>

<footer>
  <div class="footer-logo"><span class="logo-dot"></span>StockCast</div>
  <div class="footer-note">Predictions are AI-generated using market data, earnings, news sentiment, and historical patterns. This is not financial advice. Always do your own research before investing.</div>
</footer>

<script>
  // Live clock
  function updateTime() {
    document.getElementById('liveTime').textContent =
      new Date().toLocaleTimeString('en-US', {hour:'2-digit',minute:'2-digit',second:'2-digit',timeZone:'America/Chicago',timeZoneName:'short'});
  }
  updateTime(); setInterval(updateTime, 1000);

  // Countdown to next 6AM CST
  function updateCountdown() {
    const cst = new Date(new Date().toLocaleString('en-US', {timeZone:'America/Chicago'}));
    let next = new Date(cst); next.setHours(6,0,0,0);
    if (cst >= next) next.setDate(next.getDate()+1);
    const diff = next - cst;
    const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
    document.getElementById('countdown').textContent =
      `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  updateCountdown(); setInterval(updateCountdown, 1000);

  // Helpers
  const fmtDate = d => new Date(d+'T12:00:00').toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
  const sign = n => n >= 0 ? '+' : '';
  const dirClass = n => n > 0 ? 'up' : n < 0 ? 'down' : 'neutral';
  const arrow = n => n > 0 ? '▲' : n < 0 ? '▼' : '—';

  function renderIndexCard(label, d) {
    if (!d || d.value == null) return `<div class="overview-card"><div class="overview-card-label">${label}</div><div class="overview-card-value" style="color:var(--muted)">—</div><div class="overview-card-change neutral">No data</div></div>`;
    const cls = dirClass(d.change_pct);
    return `<div class="overview-card">
      <div class="overview-card-label">${label}</div>
      <div class="overview-card-value">${d.value.toLocaleString()}</div>
      <div class="overview-card-change ${cls}">${arrow(d.change_pct)} ${sign(d.change_pct)}${d.change_pct}% today</div>
    </div>`;
  }

  function renderStockRow(e, type) {
    const pct = e.predicted_change_pct;
    const cls = type === 'winner' ? 'up' : 'down';
    return `<div class="stock-row">
      <div class="stock-rank">${String(e.rank).padStart(2,'0')}</div>
      <div>
        <div class="stock-ticker">${e.ticker}</div>
        <div class="stock-name">${e.company} · ${e.sector}</div>
      </div>
      <div class="stock-right">
        <div class="stock-pred ${cls}">${sign(pct)}${pct}%</div>
        <div class="stock-reason">${e.reason}</div>
      </div>
    </div>`;
  }

  function calcAccuracy(predicted, actual) {
    const correct = (predicted > 0 && actual > 0) || (predicted < 0 && actual < 0);
    if (correct) {
      const diff = Math.abs(Math.abs(predicted) - Math.abs(actual));
      return Math.min(100, Math.round(50 + Math.max(0, 50 - diff * 10)));
    }
    return Math.max(0, Math.round(50 - Math.abs(actual - predicted) * 5));
  }

  function renderPerfRow(e, type) {
    const pred = e.predicted_change_pct;
    const actual = e.actual_change_pct;
    const isWinner = type === 'winner';
    const hasActual = actual != null;
    const accuracy = hasActual ? calcAccuracy(pred, actual) : null;
    const dirCorrect = hasActual && ((pred > 0 && actual > 0) || (pred < 0 && actual < 0));
    const outcome = !hasActual ? '' : !dirCorrect
      ? `<span style="color:var(--muted);font-size:0.72rem">✗ miss</span>`
      : Math.abs(actual) > Math.abs(pred)
        ? `<span style="color:var(--muted);font-size:0.72rem">${pred > 0 ? '▲' : '▼'} beat</span>`
        : `<span style="color:var(--muted);font-size:0.72rem">≈ close</span>`;
    const barCls = isWinner ? 'bar-fill-gain' : 'bar-fill-loss';
    const actualCls = hasActual ? dirClass(actual) : 'neutral';

    return `<tr>
      <td><span class="ticker-badge">${e.ticker}</span></td>
      <td><span class="tag ${isWinner ? 'type-winner' : 'type-loser'}">${isWinner ? 'WINNER' : 'LOSER'}</span></td>
      <td class="${isWinner ? 'up' : 'down'}">${sign(pred)}${pred}%</td>
      <td class="${actualCls}">${hasActual ? sign(actual)+actual+'% '+outcome : '<span style="color:var(--muted)">Pending</span>'}</td>
      <td>${accuracy != null
        ? `<div class="accuracy-bar"><div class="bar-track"><div class="${barCls}" style="width:${accuracy}%"></div></div><span class="${dirClass(accuracy-50)}" style="font-size:0.78rem;font-family:'DM Mono',monospace">${accuracy}%</span></div>`
        : `<span style="color:var(--muted);font-size:0.78rem;font-family:'DM Mono',monospace">—</span>`}
      </td>
    </tr>`;
  }

  async function render() {
    try {
      const res = await fetch('data.json?t=' + Date.now());
      if (!res.ok) throw new Error(`HTTP ${res.status} — data.json not found`);
      const data = await res.json();

      const { today, yesterday, indices = {} } = data;

      // Update hero summary with AI market insight
      if (today.market_summary) {
        document.getElementById('heroSummary').textContent = today.market_summary;
      }

      const hasYesterday = yesterday.winners.length > 0 || yesterday.losers.length > 0;

      document.getElementById('app').innerHTML = `
        <section class="section">
          <div class="section-header">
            <div class="section-title"><span class="dot dot-neutral"></span> Market Overview</div>
            <div class="section-date">${fmtDate(today.date)}</div>
          </div>
          <div class="overview-grid">
            ${renderIndexCard('S&P 500', indices.sp500)}
            ${renderIndexCard('NASDAQ', indices.nasdaq)}
            ${renderIndexCard('DOW JONES', indices.dow)}
          </div>
        </section>

        <section class="section">
          <div class="section-header">
            <div class="section-title"><span class="dot dot-neutral"></span> Today's Predictions</div>
            <div class="section-date">Updated 6:00 AM CST</div>
          </div>
          <div class="stocks-layout">
            <div class="stock-panel">
              <div class="panel-header">
                <div class="panel-title">Top 10 Expected Winners <span class="pill pill-gain">↑ GAIN</span></div>
              </div>
              ${today.winners.map(e => renderStockRow(e, 'winner')).join('')}
            </div>
            <div class="stock-panel">
              <div class="panel-header">
                <div class="panel-title">Top 10 Expected Losers <span class="pill pill-loss">↓ LOSS</span></div>
              </div>
              ${today.losers.map(e => renderStockRow(e, 'loser')).join('')}
            </div>
          </div>
        </section>

        <section class="section">
          <div class="section-header">
            <div class="section-title"><span class="dot dot-accent"></span> Yesterday's Performance</div>
            <div class="section-date">${fmtDate(yesterday.date)}</div>
          </div>
          <div class="perf-panel">
            ${!hasYesterday
              ? `<div class="pending-note">No predictions recorded for yesterday yet.<br>Performance tracking begins after the second daily run.</div>`
              : `<table class="perf-table">
                  <thead><tr><th>Ticker</th><th>Type</th><th>Predicted</th><th>Actual</th><th>Accuracy</th></tr></thead>
                  <tbody>
                    <tr class="group-header group-winner"><td colspan="5">▲ Predicted Winners</td></tr>
                    ${yesterday.winners.map(e => renderPerfRow(e, 'winner')).join('')}
                    <tr class="group-header group-loser"><td colspan="5">▼ Predicted Losers</td></tr>
                    ${yesterday.losers.map(e => renderPerfRow(e, 'loser')).join('')}
                  </tbody>
                </table>`
            }
          </div>
        </section>
      `;

    } catch (err) {
      document.getElementById('app').innerHTML = `
        <div class="loading-msg">
          ⚠ Could not load market data.<br>
          Make sure <strong>data.json</strong> is in the same folder as this HTML file.<br>
          <span style="font-size:0.75rem">${err.message}</span>
        </div>`;
    }
  }

  render();
</script>
</body>
</html>
